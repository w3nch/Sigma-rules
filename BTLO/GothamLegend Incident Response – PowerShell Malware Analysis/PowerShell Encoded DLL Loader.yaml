title: Emotet (Heodo) PowerShell EncodedCommand DLL Loader via Rundll32
id: 7c3b8b41-1f8e-4e2a-9e7c-3f7b2d4e9d21
status: experimental
description: >
  Detects Emotet (aka Heodo) infection chain where PowerShell uses
  EncodedCommand to download a DLL payload and execute it via rundll32.exe.
  This behavior is commonly observed in malspam-delivered Emotet campaigns.
author: IR Team
date: 2026/01/15
modified: 2026/01/15
references:
  - https://attack.mitre.org/techniques/T1059/001/
  - https://attack.mitre.org/techniques/T1218/011/
  - https://attack.mitre.org/techniques/T1105/
  - https://bazaar.abuse.ch/sample/23be1cb22c94fe77cea5f8e7fef6710eeef5a23e7e7eb9b9dd53f56d1b954269/
  - https://www.capesandbox.com/analysis/110417/
tags:
  - attack.execution
  - attack.t1059.001        # PowerShell
  - attack.t1105            # Ingress Tool Transfer
  - attack.t1218.011        # Rundll32
  - attack.t1027            # Obfuscated Files or Information
  - malware.emotet
  - malware.heodo
  - malware.loader
  - malspam
  - powershell

logsource:
  category: process_creation
  product: windows

detection:
  powershell_encoded:
    Image|endswith:
      - powershell.exe
      - pwsh.exe
    CommandLine|contains:
      - '-enc'
      - '-EncodedCommand'

  powershell_network_loader:
    CommandLine|contains:
      - 'System.Net.WebClient'
      - 'DownloadFile'
      - 'Tls12'

  rundll32_dll_exec:
    Image|endswith: rundll32.exe
    CommandLine|contains:
      - '.dll'
      - 'Control_RunDLL'

  user_writable_dll:
    CommandLine|contains:
      - '\\Users\\'
      - '\\AppData\\'
      - '\\Temp\\'
      - '\\Downloads\\'

  condition: >
    powershell_encoded and
    powershell_network_loader and
    rundll32_dll_exec and
    user_writable_dll

falsepositives:
  - Rare administrative scripts using EncodedCommand and rundll32
  - Red team simulations mimicking Emotet tradecraft

level: critical